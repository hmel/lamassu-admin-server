#!/usr/bin/env node

const fs = require('fs')
const path = require('path')
const login = require('../login')

const configPath = path.resolve(__dirname, '..', 'config.json')

const name = process.argv[2]
let domain

try {
  domain = JSON.parse(fs.readFileSync(configPath))
} catch (err) {
  console.log('Missing config file: %s', err)
  process.exit(1)
}

if (!name) {
  console.log('Usage: lamassu-register <username>')
  process.exit(1)
}

login.generateOTP(name)
.then(otp => {
  console.log(`https://${domain}?otp=${otp}`)
  process.exit(0)
})
.catch(err => {
  console.log('Error: %s', err)
  process.exit(2)
})
